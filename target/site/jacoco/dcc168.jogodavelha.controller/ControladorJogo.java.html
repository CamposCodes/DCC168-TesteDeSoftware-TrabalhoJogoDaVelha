<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ControladorJogo.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jogo da Velha</a> &gt; <a href="index.source.html" class="el_package">dcc168.jogodavelha.controller</a> &gt; <span class="el_source">ControladorJogo.java</span></div><h1>ControladorJogo.java</h1><pre class="source lang-java linenums">package dcc168.jogodavelha.controller;

import dcc168.jogodavelha.model.Tabuleiro;
import dcc168.jogodavelha.model.EstadoJogo;
import dcc168.jogodavelha.model.Jogador;
import dcc168.jogodavelha.model.ValidadorEstado;
import dcc168.jogodavelha.strategy.EstrategiaJogador;
import dcc168.jogodavelha.view.VisaoJogo;
import java.util.ArrayList;
import java.util.List;

/**
 * Controlador do jogo - gerencia a lógica de fluxo do jogo.
 * Implementa o padrão MVC como intermediário entre Model e View.
 */
public class ControladorJogo {
    private Tabuleiro tabuleiro;
    private VisaoJogo visao;
    private ValidadorEstado validador;
    private EstadoJogo estadoAtual;
    private List&lt;Jogador&gt; jogadores;
    private int indiceJogadorAtual;
    private List&lt;EstrategiaJogador&gt; estrategias;

    /**
     * Constrói o controlador do jogo.
     *
     * @param visao visualização do jogo
     */
<span class="fc" id="L30">    public ControladorJogo(VisaoJogo visao) {</span>
<span class="fc" id="L31">        this.tabuleiro = new Tabuleiro();</span>
<span class="fc" id="L32">        this.visao = visao;</span>
<span class="fc" id="L33">        this.validador = new ValidadorEstado();</span>
<span class="fc" id="L34">        this.estadoAtual = EstadoJogo.AGUARDANDO_JOGADA;</span>
<span class="fc" id="L35">        this.jogadores = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L36">        this.estrategias = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L37">        this.indiceJogadorAtual = 0;</span>
<span class="fc" id="L38">    }</span>

    /**
     * Adiciona um jogador ao jogo.
     *
     * @param jogador jogador a ser adicionado
     * @param estrategia estratégia do jogador
     * @throws IllegalStateException se há mais de 2 jogadores
     */
    public void adicionarJogador(Jogador jogador, EstrategiaJogador estrategia) {
<span class="fc bfc" id="L48" title="All 2 branches covered.">        if (jogadores.size() &gt;= 2) {</span>
<span class="fc" id="L49">            throw new IllegalStateException(&quot;Máximo de 2 jogadores!&quot;);</span>
        }
<span class="fc" id="L51">        jogadores.add(jogador);</span>
<span class="fc" id="L52">        estrategias.add(estrategia);</span>
<span class="fc" id="L53">    }</span>

    /**
     * Inicia o jogo.
     *
     * @throws IllegalStateException se há menos de 2 jogadores
     */
    public void iniciarJogo() {
<span class="fc bfc" id="L61" title="All 2 branches covered.">        if (jogadores.size() &lt; 2) {</span>
<span class="fc" id="L62">            throw new IllegalStateException(&quot;É necessário exatamente 2 jogadores!&quot;);</span>
        }
<span class="fc" id="L64">        tabuleiro.reiniciar();</span>
<span class="fc" id="L65">        estadoAtual = EstadoJogo.AGUARDANDO_JOGADA;</span>
<span class="fc" id="L66">        indiceJogadorAtual = 0;</span>
<span class="fc" id="L67">        visao.exibirMensagem(&quot;=== JOGO INICIADO ===\n&quot;);</span>
<span class="fc" id="L68">    }</span>

    /**
     * Executa a próxima jogada do jogo.
     *
     * @throws IllegalStateException se o jogo já terminou
     */
    public void executarTurno() {
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">        if (estadoAtual != EstadoJogo.AGUARDANDO_JOGADA) {</span>
<span class="nc" id="L77">            throw new IllegalStateException(&quot;Jogo já terminou!&quot;);</span>
        }

<span class="fc" id="L80">        Jogador jogadorAtual = jogadores.get(indiceJogadorAtual);</span>
<span class="fc" id="L81">        EstrategiaJogador estrategia = estrategias.get(indiceJogadorAtual);</span>
<span class="fc" id="L82">        char simbolo = jogadorAtual.obterSimbolo();</span>

<span class="fc" id="L84">        visao.exibirTabuleiro(tabuleiro);</span>
<span class="fc" id="L85">        visao.exibirJogadorAtual(jogadorAtual.obterNome(), simbolo);</span>

        try {
<span class="fc" id="L88">            int[] jogada = estrategia.fazerJogada(tabuleiro, simbolo);</span>
<span class="fc" id="L89">            tabuleiro.marcarPosicao(jogada[0], jogada[1], simbolo);</span>

            // Verificar vitória
<span class="fc bfc" id="L92" title="All 2 branches covered.">            if (validador.verificarVitoria(tabuleiro, simbolo)) {</span>
<span class="pc bpc" id="L93" title="1 of 2 branches missed.">                estadoAtual = simbolo == 'X' ? EstadoJogo.VITORIA_X : EstadoJogo.VITORIA_O;</span>
<span class="fc" id="L94">                visao.exibirTabuleiro(tabuleiro);</span>
<span class="fc" id="L95">                visao.exibirFimJogo(estadoAtual, jogadorAtual.obterNome());</span>
            }
            // Verificar empate
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">            else if (validador.verificarEmpate(tabuleiro)) {</span>
<span class="nc" id="L99">                estadoAtual = EstadoJogo.EMPATE;</span>
<span class="nc" id="L100">                visao.exibirTabuleiro(tabuleiro);</span>
<span class="nc" id="L101">                visao.exibirFimJogo(estadoAtual, null);</span>
            }
            // Alternar jogador
            else {
<span class="fc" id="L105">                indiceJogadorAtual = (indiceJogadorAtual + 1) % 2;</span>
            }
<span class="nc" id="L107">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L108">            visao.exibirMensagem(&quot;Jogada inválida: &quot; + e.getMessage());</span>
<span class="fc" id="L109">        }</span>
<span class="fc" id="L110">    }</span>

    /**
     * Reinicia o jogo.
     */
    public void reiniciarJogo() {
<span class="fc" id="L116">        iniciarJogo();</span>
<span class="fc" id="L117">    }</span>

    /**
     * Obtém o estado atual do jogo.
     *
     * @return estado atual
     */
    public EstadoJogo obterEstadoAtual() {
<span class="fc" id="L125">        return estadoAtual;</span>
    }

    /**
     * Obtém o tabuleiro atual.
     *
     * @return tabuleiro do jogo
     */
    public Tabuleiro obterTabuleiro() {
<span class="fc" id="L134">        return tabuleiro;</span>
    }

    /**
     * Obtém o jogador atual.
     *
     * @return jogador atual
     */
    public Jogador obterJogadorAtual() {
<span class="fc" id="L143">        return jogadores.get(indiceJogadorAtual);</span>
    }

    /**
     * Obtém todos os jogadores.
     *
     * @return lista de jogadores
     */
    public List&lt;Jogador&gt; obterJogadores() {
<span class="fc" id="L152">        return new ArrayList&lt;&gt;(jogadores);</span>
    }

    /**
     * Obtém o índice do jogador atual.
     *
     * @return índice (0 ou 1)
     */
    public int obterIndiceJogadorAtual() {
<span class="fc" id="L161">        return indiceJogadorAtual;</span>
    }

    /**
     * Define manualmente o estado do jogo (para testes).
     *
     * @param estado novo estado
     */
    public void definirEstadoAtual(EstadoJogo estado) {
<span class="fc" id="L170">        this.estadoAtual = estado;</span>
<span class="fc" id="L171">    }</span>

    /**
     * Verifica se o jogo terminou.
     *
     * @return true se o jogo terminou
     */
    public boolean jogoTerminou() {
<span class="fc bfc" id="L179" title="All 2 branches covered.">        return estadoAtual != EstadoJogo.AGUARDANDO_JOGADA;</span>
    }

    /**
     * Obtém o vencedor do jogo (null se empate ou jogo em andamento).
     *
     * @return vencedor ou null
     */
    public Jogador obterVencedor() {
<span class="fc bfc" id="L188" title="All 2 branches covered.">        if (estadoAtual == EstadoJogo.VITORIA_X) {</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">            for (Jogador j : jogadores) {</span>
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">                if (j.obterSimbolo() == 'X') {</span>
<span class="fc" id="L191">                    return j;</span>
                }
<span class="nc" id="L193">            }</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">        } else if (estadoAtual == EstadoJogo.VITORIA_O) {</span>
<span class="pc bpc" id="L195" title="1 of 2 branches missed.">            for (Jogador j : jogadores) {</span>
<span class="fc bfc" id="L196" title="All 2 branches covered.">                if (j.obterSimbolo() == 'O') {</span>
<span class="fc" id="L197">                    return j;</span>
                }
<span class="fc" id="L199">            }</span>
        }
<span class="fc" id="L201">        return null;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>